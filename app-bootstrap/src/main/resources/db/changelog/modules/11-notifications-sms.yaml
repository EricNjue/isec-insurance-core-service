databaseChangeLog:
  - changeSet:
      id: 11-01-create-sms-message
      author: junie
      changes:
        - createTable:
            tableName: sms_message
            columns:
              - column: { name: id, type: UUID, constraints: { primaryKey: true, nullable: false } }
              - column: { name: recipient_to, type: VARCHAR(50), constraints: { nullable: false } }
              - column: { name: message_content, type: VARCHAR(1000), constraints: { nullable: false } }
              - column: { name: sender_from, type: VARCHAR(50) }
              - column: { name: provider, type: VARCHAR(50) }
              - column: { name: provider_request_id, type: VARCHAR(100) }
              - column: { name: created_at, type: TIMESTAMP, constraints: { nullable: false } }
              - column: { name: status_summary, type: VARCHAR(255) }
              - column: { name: total_cost, type: VARCHAR(50) }
        - createIndex:
            indexName: idx_sms_message_to
            tableName: sms_message
            columns:
              - column: { name: recipient_to }
        - createIndex:
            indexName: idx_sms_message_created_at
            tableName: sms_message
            columns:
              - column: { name: created_at }
  - changeSet:
      id: 11-02-create-sms-recipient-result
      author: junie
      changes:
        - createTable:
            tableName: sms_recipient_result
            columns:
              - column: { name: id, type: UUID, constraints: { primaryKey: true, nullable: false } }
              - column: { name: sms_message_id, type: UUID, constraints: { nullable: false } }
              - column: { name: number, type: VARCHAR(50), constraints: { nullable: false } }
              - column: { name: message_id, type: VARCHAR(150) }
              - column: { name: status, type: VARCHAR(50) }
              - column: { name: status_code, type: INT }
              - column: { name: cost, type: VARCHAR(50) }
              - column: { name: delivery_status, type: VARCHAR(50) }
              - column: { name: delivery_failure_reason, type: VARCHAR(255) }
              - column: { name: delivery_reported_at, type: TIMESTAMP }
              - column: { name: created_at, type: TIMESTAMP, constraints: { nullable: false } }
        - addForeignKeyConstraint:
            baseTableName: sms_recipient_result
            baseColumnNames: sms_message_id
            referencedTableName: sms_message
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_recipient_sms_message
        - createIndex:
            indexName: idx_recipient_number
            tableName: sms_recipient_result
            columns:
              - column: { name: number }
        - createIndex:
            indexName: idx_recipient_message_id
            tableName: sms_recipient_result
            columns:
              - column: { name: message_id }
        - createIndex:
            indexName: idx_recipient_created_at
            tableName: sms_recipient_result
            columns:
              - column: { name: created_at }
  - changeSet:
      id: 11-03-create-sms-delivery-report
      author: junie
      changes:
        - createTable:
            tableName: sms_delivery_report
            columns:
              - column: { name: id, type: UUID, constraints: { primaryKey: true, nullable: false } }
              - column: { name: message_id, type: VARCHAR(150), constraints: { nullable: false } }
              - column: { name: phone_number, type: VARCHAR(50) }
              - column: { name: status, type: VARCHAR(50) }
              - column: { name: failure_reason, type: VARCHAR(255) }
              - column: { name: retry_count, type: INT }
              - column: { name: network_code, type: VARCHAR(50) }
              - column: { name: raw_payload, type: CLOB }
              - column: { name: received_at, type: TIMESTAMP, constraints: { nullable: false } }
        - createIndex:
            indexName: idx_report_message_id
            tableName: sms_delivery_report
            columns:
              - column: { name: message_id }
        - addUniqueConstraint:
            tableName: sms_delivery_report
            columnNames: message_id
            constraintName: uq_delivery_report_message_id
